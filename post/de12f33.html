<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="baidu-site-verification" content="mXGc57bzu6">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"titanjun.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="Sign In with Apple">
<meta property="og:url" content="https://titanjun.top/post/de12f33.html">
<meta property="og:site_name" content="TitanKing">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/appleicon.png?x-oss-process=style/titanjun">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_apple.png">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/applesign.png">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_type.png">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_style.jpg">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_sign.jpeg?x-oss-process=image/resize,m_lfit,h_500">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_name.jpeg?x-oss-process=image/resize,m_lfit,h_500">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_has.jpeg?x-oss-process=image/resize,m_lfit,h_500">
<meta property="og:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_noid.png">
<meta property="article:published_time" content="2019-09-30T09:36:20.000Z">
<meta property="article:modified_time" content="2023-01-20T13:14:39.898Z">
<meta property="article:author" content="TitanKing">
<meta property="article:tag" content="iOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/appleicon.png?x-oss-process=style/titanjun">


<link rel="canonical" href="https://titanjun.top/post/de12f33.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://titanjun.top/post/de12f33.html","path":"post/de12f33.html","title":"Sign In with Apple"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Sign In with Apple | TitanKing</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9X3SQNQRQZ"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-9X3SQNQRQZ","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?bb0d06abde4ca5c3660fdcb01693e9a2"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="TitanKing" type="application/atom+xml">
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">TitanKing</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">技术博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>列表<span class="badge">104</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">17</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">50</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-navigation"><a href="/navigation/" rel="section"><i class="fa fa-globe fa-fw"></i>导航</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Sign-in-with-Apple"><span class="nav-number">1.</span> <span class="nav-text">Sign in with Apple</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E6%8C%89%E9%92%AE"><span class="nav-number">2.</span> <span class="nav-text">登录按钮</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ButtonType"><span class="nav-number">2.1.</span> <span class="nav-text">ButtonType</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Style"><span class="nav-number">2.2.</span> <span class="nav-text">Style</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cornerRadius"><span class="nav-number">2.3.</span> <span class="nav-text">cornerRadius</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%91%E8%B5%B7%E6%8E%88%E6%9D%83%E8%AF%B7%E6%B1%82"><span class="nav-number">3.</span> <span class="nav-text">发起授权请求</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#delegate"><span class="nav-number">3.1.</span> <span class="nav-text">delegate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#presentationContextProvider"><span class="nav-number">3.2.</span> <span class="nav-text">presentationContextProvider</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASAuthorization"><span class="nav-number">3.3.</span> <span class="nav-text">ASAuthorization</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASAuthorizationCredential"><span class="nav-number">3.4.</span> <span class="nav-text">ASAuthorizationCredential</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ASPasswordCredential"><span class="nav-number">3.4.1.</span> <span class="nav-text">ASPasswordCredential</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ASAuthorizationAppleIDCredential"><span class="nav-number">3.4.2.</span> <span class="nav-text">ASAuthorizationAppleIDCredential</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ASAuthorizationSingleSignOnCredential"><span class="nav-number">3.4.3.</span> <span class="nav-text">ASAuthorizationSingleSignOnCredential</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%88%E6%9D%83%E6%88%90%E5%8A%9F"><span class="nav-number">3.5.</span> <span class="nav-text">授权成功</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E6%8E%88%E6%9D%83%E7%8A%B6%E6%80%81"><span class="nav-number">4.</span> <span class="nav-text">监听授权状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="nav-number">5.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="/">
      <img class="site-author-image" itemprop="image" alt="TitanKing"
        src="/images/avatar.jpg">
    </a>
  <p class="site-author-name" itemprop="name">TitanKing</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/CoderTitan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CoderTitan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/ShmilyCoder" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;ShmilyCoder" rel="noopener" target="_blank"><i class="fa fa-book fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:titanking2014@163.com" title="E-Mail → mailto:titanking2014@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>


      
      
      <script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"></script>
      <script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"></script>
      <div class="widget-wrap">
          <h3 class="widget-title">标签云</h3>
          <div id="myCanvasContainer" class="widget tagcloud">
              <canvas width="250" height="250" id="resCanvas" style="width=100%">
                  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/avfoundation/" rel="tag">AVFoundation</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animated/" rel="tag">Animated</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/block/" rel="tag">Block</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cidetector/" rel="tag">CIDetector</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cifilter/" rel="tag">CIFilter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">CSS</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocoapods/" rel="tag">CocoaPods</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coreanimation/" rel="tag">CoreAnimation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coreimage/" rel="tag">CoreImage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dart/" rel="tag">Dart</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flutter/" rel="tag">Flutter</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">HTML5</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">Hexo</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">JavaScript</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">MongoDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">MySQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nsrunloop/" rel="tag">NSRunLoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/navigator/" rel="tag">Navigator</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/next/" rel="tag">NexT</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">Node</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objective-c/" rel="tag">Objective-C</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/property/" rel="tag">Property</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">Python</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/r-swift/" rel="tag">R.Swift</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reactnative/" rel="tag">ReactNative</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reactivecocoa/" rel="tag">ReactiveCocoa</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/realm/" rel="tag">Realm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rxswift/" rel="tag">RxSwift</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/" rel="tag">Socket</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/" rel="tag">Speech</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/" rel="tag">Swift</a><span class="tag-list-count">34</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swiftlint/" rel="tag">SwiftLint</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textfield/" rel="tag">TextField</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tkinter/" rel="tag">Tkinter</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uistackview/" rel="tag">UIStackView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vision/" rel="tag">Vision</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/" rel="tag">WebView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/widget/" rel="tag">Widget</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fastlane/" rel="tag">fastlane</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">iOS</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pymongo/" rel="tag">pymongo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">内存管理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%BD%E6%95%B0%E5%BC%8F/" rel="tag">函数式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F/" rel="tag">响应式</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%AD%E6%B3%95/" rel="tag">语法</a><span class="tag-list-count">4</span></li></ul>
              </canvas>
          </div>
      </div>
      
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/CoderTitan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://titanjun.top/post/de12f33.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="TitanKing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TitanKing">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Sign In with Apple | TitanKing">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Sign In with Apple
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-30 17:36:20" itemprop="dateCreated datePublished" datetime="2019-09-30T17:36:20+08:00">2019-09-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-20 21:14:39" itemprop="dateModified" datetime="2023-01-20T21:14:39+08:00">2023-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ios/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/appleicon.png?x-oss-process=style/titanjun" alt="image"></p>
<span id="more"></span>





<ul>
<li>原文博客地址: <a target="_blank" rel="noopener" href="https://www.titanjun.top/">Sign In With Apple</a></li>
<li>在之前的文章<a target="_blank" rel="noopener" href="https://www.titanjun.top/iOS13%E9%80%82%E9%85%8D%E6%B7%B1%E8%89%B2%E6%A8%A1%E5%BC%8F(Dark%20Mode).html">iOS13适配深色模式(Dark Mode)</a>中只是简单提到了关于<a target="_blank" rel="noopener" href="https://www.titanjun.top/">Sign In With Apple</a>的问题, 下面就着重介绍一下什么是<code>Apple</code>登录</li>
<li>对于很多应用都会有自己的账号登录体系, 但是一般都相对繁琐, 或者用户会忘记密码等, 为此一般都会接入微信、<code>QQ</code>登录, 国外应用也会有<code>Google</code>、<code>Facebook</code>等第三方登录方式</li>
<li>在<code>WWDC 2019</code>上, 苹果要求使用第三方登录的应用也必须接入苹果账号登录(2020年必须适配)</li>
<li>当然了如果你的<code>App</code>没有提供第三方登录，那就不用集成; 如果用到了第三方登录，那么需要提供<code>Sign in with Apple</code></li>
</ul>
<h2 id="Sign-in-with-Apple"><a href="#Sign-in-with-Apple" class="headerlink" title="Sign in with Apple"></a>Sign in with Apple</h2><blockquote>
<p>Sign in with Apple makes it easy for users to sign in to your apps and websites using their Apple ID. Instead of filling out forms, verifying email addresses, and choosing new passwords, they can use Sign in with Apple to set up an account and start using your app right away. All accounts are protected with two-factor authentication for superior security, and Apple will not track users’ activity in your app or website.</p>
</blockquote>
<blockquote>
<p>Make signing in easy</p>
</blockquote>
<ul>
<li><code>Sign In with Apple</code>为用户提供一种快速安全的登录方式, 用户可以轻松登录开发者的应用和网站</li>
<li>使用<code>Apple</code>登录可以让用户在系统中设置用户帐户，开发者可以获取到用户名称(<code>Name</code>), 用户唯一标识符(<code>ID</code>)以及经过验证的电子邮件地址(<code>email</code>)</li>
<li><code>Sign In with Apple</code>相关特性<ul>
<li>尊重用户隐私: 开发人员仅仅只能获取到用户的姓名和邮箱, 苹果也不会收集用户和应用交互的任何信息</li>
<li>系统内置的安全性：<code>2F</code>双重验证(<code>Face ID</code>或<code>Touch ID</code>)，从此登录不再需要密码</li>
<li>简化账号的创建和登录流程，无缝跨设备使用</li>
<li>开发者可以获取到已验证过的邮箱作为登录账号或者与用户进行通信（注：用户可以选择隐藏真实邮箱，并使用苹果提供的虚拟邮箱进行授权）</li>
<li>可跨平台使用, Apple登录支持<code>iOS</code>，<code>macOS</code>，<code>tvOS</code>和<code>watchOS</code>以及<code>JavaScript</code></li>
<li>更多信息可惨考<a target="_blank" rel="noopener" href="https://developer.apple.com/sign-in-with-apple/"><br>使用Apple登录</a></li>
</ul>
</li>
</ul>
<div class="note info"><p>在代码集成之前还需要做一些准备工作</p></div>


<ol>
<li>在开发者网站，在需要添加<code>Sign in with Apple</code>功能</li>
</ol>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_apple.png" alt="image"></p>
<ol start="2">
<li>在<code>Xcode</code>里面开启<code>Sign in with Apple</code>功能</li>
</ol>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/applesign.png" alt="Xcode"></p>
<h2 id="登录按钮"><a href="#登录按钮" class="headerlink" title="登录按钮"></a>登录按钮</h2><p><code>Apple</code>苹果登录按钮, 需要使用<code>ASAuthorizationAppleIDButton</code>类创建添加, 该类是<code>iOS 13</code>苹果提供的创建<code>Apple</code>登录按钮的专属类</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ASAuthorizationAppleIDButton</span> : <span class="title class_">UIControl</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(<span class="params">type</span>: <span class="type">ASAuthorizationAppleIDButton</span>.<span class="type">ButtonType</span>, <span class="params">style</span>: <span class="type">ASAuthorizationAppleIDButton</span>.<span class="type">Style</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">authorizationButtonType</span> <span class="params">type</span>: <span class="type">ASAuthorizationAppleIDButton</span>.<span class="type">ButtonType</span>, <span class="params">authorizationButtonStyle</span> <span class="params">style</span>: <span class="type">ASAuthorizationAppleIDButton</span>.<span class="type">Style</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置按钮的圆切角</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> cornerRadius: <span class="type">CGFloat</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开始创建<code>Apple</code>登录按钮</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// apple登录按钮</span></span><br><span class="line"><span class="keyword">let</span> appleButton <span class="operator">=</span> <span class="type">ASAuthorizationAppleIDButton</span>(type: .continue, style: .black)</span><br><span class="line">appleButton.frame <span class="operator">=</span> <span class="type">CGRect</span>(x: <span class="number">100</span>, y: showLabel.frame.maxY <span class="operator">+</span> <span class="number">40</span>, width: <span class="number">200</span>, height: <span class="number">50</span>)</span><br><span class="line">appleButton.cornerRadius <span class="operator">=</span> <span class="number">10</span></span><br><span class="line">appleButton.addTarget(<span class="keyword">self</span>, action: <span class="keyword">#selector</span>(appleAction), for: .touchUpInside)</span><br><span class="line">view.addSubview(appleButton)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>ASAuthorizationAppleIDButton</code>的初始化方法中有两个参数<code>type</code>和<code>style</code></li>
<li><code>type</code>是设置按钮的类型<code>ASAuthorizationAppleIDButton.ButtonType</code></li>
<li><code>style</code>设置按钮的样式<code>ASAuthorizationAppleIDButton.Style</code></li>
<li>可参考官网介绍<a target="_blank" rel="noopener" href="https://developer.apple.com/design/human-interface-guidelines/sign-in-with-apple/overview/">Sign In with Apple</a></li>
</ul>
<h3 id="ButtonType"><a href="#ButtonType" class="headerlink" title="ButtonType"></a>ButtonType</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ButtonType</span> : <span class="title class_">Int</span> &#123;</span><br><span class="line">    <span class="comment">// signIn登录类型</span></span><br><span class="line">    <span class="keyword">case</span> signIn</span><br><span class="line">    <span class="comment">// continue类型</span></span><br><span class="line">    <span class="keyword">case</span> `continue`</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">var</span> `default`: <span class="type">ASAuthorizationAppleIDButton</span>.<span class="type">ButtonType</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>不同<code>ButtonType</code>展示效果如下</p>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_type.png" alt="ButtonType"></p>
<h3 id="Style"><a href="#Style" class="headerlink" title="Style"></a>Style</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Style</span> : <span class="title class_">Int</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">case</span> white</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> whiteOutline</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> black</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>不同<code>Style</code>展示效果和使用场景如下</p>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_style.jpg" alt="Style"></p>
<h3 id="cornerRadius"><a href="#cornerRadius" class="headerlink" title="cornerRadius"></a>cornerRadius</h3><p>设置按钮的圆角大小</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认值大概5左右, 具体值不知</span></span><br><span class="line">appleButton.cornerRadius <span class="operator">=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h2 id="发起授权请求"><a href="#发起授权请求" class="headerlink" title="发起授权请求"></a>发起授权请求</h2><p>在创建好登录按钮后, 点击按钮的操作就是, 根据用户登录的<code>AppleID</code>发起授权请求, 并获得授权码</p>
<ul>
<li><code>iOS 13</code>系统给我们提供了一个<code>ASAuthorizationAppleIDProvider</code>类</li>
<li>该类就是一种基于用户的<code>AppleID</code>生成用户的授权请求的一种机制</li>
<li>在发起授权请求之前, 需要配置要获取的数据权限范围（例如：用户名、邮箱等）</li>
<li>为获取授权结果, 还需要设置回调代理, 并发起授权请求</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@objc</span> <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">appleAction</span>() &#123;</span><br><span class="line">    <span class="comment">// 基于用户的Apple ID授权用户，生成用户授权请求的一种机制</span></span><br><span class="line">    <span class="keyword">let</span> appleIDProvider <span class="operator">=</span> <span class="type">ASAuthorizationAppleIDProvider</span>()</span><br><span class="line">    <span class="comment">// 创建新的AppleID授权请求</span></span><br><span class="line">    <span class="keyword">let</span> request <span class="operator">=</span> appleIDProvider.createRequest()</span><br><span class="line">    <span class="comment">// 所需要请求的联系信息</span></span><br><span class="line">    request.requestedScopes <span class="operator">=</span> [.fullName, .email]</span><br><span class="line">    <span class="comment">// 管理授权请求的控制器</span></span><br><span class="line">    <span class="keyword">let</span> controller <span class="operator">=</span> <span class="type">ASAuthorizationController</span>(authorizationRequests: [request])</span><br><span class="line">    <span class="comment">// 授权成功或者失败的代理</span></span><br><span class="line">    controller.delegate <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    <span class="comment">// 显示上下文的代理, 系统可以在上下文中向用户展示授权页面</span></span><br><span class="line">    controller.presentationContextProvider <span class="operator">=</span> <span class="keyword">self</span></span><br><span class="line">    <span class="comment">// 在控制器初始化期间启动授权流</span></span><br><span class="line">    controller.performRequests()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="delegate"><a href="#delegate" class="headerlink" title="delegate"></a>delegate</h3><p>设置授权控制器通知授权请求的成功与失败的代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 代理</span><br><span class="line">weak open var delegate: ASAuthorizationControllerDelegate?</span><br><span class="line"></span><br><span class="line">// 代理方法如下</span><br><span class="line">@available(iOS 13.0, *)</span><br><span class="line">public protocol ASAuthorizationControllerDelegate : NSObjectProtocol &#123;</span><br><span class="line">    // 授权成功的回调</span><br><span class="line">    optional func authorizationController(controller: ASAuthorizationController, didCompleteWithAuthorization authorization: ASAuthorization)</span><br><span class="line"></span><br><span class="line">    // 授权失败的回调</span><br><span class="line">    optional func authorizationController(controller: ASAuthorizationController, didCompleteWithError error: Error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="presentationContextProvider"><a href="#presentationContextProvider" class="headerlink" title="presentationContextProvider"></a>presentationContextProvider</h3><p>需要向用户展示授权页面时, 需要遵循该协议</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示上下文的代理, 系统可以在上下文中向用户展示授权页面</span></span><br><span class="line"><span class="keyword">weak</span> <span class="keyword">open</span> <span class="keyword">var</span> presentationContextProvider: <span class="type">ASAuthorizationControllerPresentationContextProviding</span>?</span><br><span class="line"></span><br><span class="line"><span class="comment">// 协议方法</span></span><br><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">protocol</span> <span class="title class_">ASAuthorizationControllerPresentationContextProviding</span> : <span class="title class_">NSObjectProtocol</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 该方法返回一个视图锚点, 告诉代理应该在哪个window 展示内容给用户</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">presentationAnchor</span>(<span class="params">for</span> <span class="params">controller</span>: <span class="type">ASAuthorizationController</span>) -&gt; <span class="type">ASPresentationAnchor</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法执行示例</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">presentationAnchor</span>(<span class="params">for</span> <span class="params">controller</span>: <span class="type">ASAuthorizationController</span>) -&gt; <span class="type">ASPresentationAnchor</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>.view.window<span class="operator">!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="ASAuthorization"><a href="#ASAuthorization" class="headerlink" title="ASAuthorization"></a>ASAuthorization</h3><ul>
<li>在控制器获得授权的成功回调中, 协议方法提供了一个<code>ASAuthorization</code></li>
<li><code>ASAuthorization</code>是对控制器成功授权的封装, 包括两个属性</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ASAuthorization</span> : <span class="title class_">NSObject</span> &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建发起成功授权的发起者</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> provider: <span class="type">ASAuthorizationProvider</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成功授权后返回的相关凭证, 包含授权后的相关信息,是一个协议</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> credential: <span class="type">ASAuthorizationCredential</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ASAuthorizationCredential"><a href="#ASAuthorizationCredential" class="headerlink" title="ASAuthorizationCredential"></a>ASAuthorizationCredential</h3><p>是一个协议, 在处理授权成功的结果中, 需要使用遵循该协议的类, 有以下三个</p>
<ul>
<li><code>ASPasswordCredential</code>: 密码凭证</li>
<li><code>ASAuthorizationAppleIDCredential</code>: Apple ID身份验证成功产生的凭证</li>
<li><code>ASAuthorizationSingleSignOnCredential</code>: 单点登录（SSO）身份验证产生的凭据</li>
</ul>
<h4 id="ASPasswordCredential"><a href="#ASPasswordCredential" class="headerlink" title="ASPasswordCredential"></a>ASPasswordCredential</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">12.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ASPasswordCredential</span> : <span class="title class_">NSObject</span>, <span class="title class_">ASAuthorizationCredential</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(<span class="params">user</span>: <span class="type">String</span>, <span class="params">password</span>: <span class="type">String</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> user: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户密码</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> password: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="ASAuthorizationAppleIDCredential"><a href="#ASAuthorizationAppleIDCredential" class="headerlink" title="ASAuthorizationAppleIDCredential"></a>ASAuthorizationAppleIDCredential</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ASAuthorizationAppleIDCredential</span> : <span class="title class_">NSObject</span>, <span class="title class_">ASAuthorizationCredential</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 和用户AppleID关联的用户ID(标识符)</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> user: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传送给ASAuthorizationRequest的字符串</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> state: <span class="type">String</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户授权的可访问的联系信息的种类</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> authorizedScopes: [<span class="type">ASAuthorization</span>.<span class="type">Scope</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为APP提供的授权证明的有效token</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> authorizationCode: <span class="type">Data</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON Web Token (JWT), 用于以安全的方式向应用程序传递关于用户身份的信息</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> identityToken: <span class="type">Data</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户的email</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> email: <span class="type">String</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> fullName: <span class="type">PersonNameComponents</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户是否是真实用户的状态</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> realUserStatus: <span class="type">ASUserDetectionStatus</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户是否是真实用户的枚举值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ASUserDetectionStatus</span> : <span class="title class_">Int</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> unsupported</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> unknown</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> likelyReal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ASAuthorizationSingleSignOnCredential"><a href="#ASAuthorizationSingleSignOnCredential" class="headerlink" title="ASAuthorizationSingleSignOnCredential"></a>ASAuthorizationSingleSignOnCredential</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">ASAuthorizationSingleSignOnCredential</span> : <span class="title class_">NSObject</span>, <span class="title class_">ASAuthorizationCredential</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// AuthenticationServices返回的字符串</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> state: <span class="type">String</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户获取授权范围的token</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> accessToken: <span class="type">Data</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON Web Token (JWT), 用于以安全的方式向应用程序传递关于用户身份的信息</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> identityToken: <span class="type">Data</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户授权的可访问的联系信息的种类</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> authorizedScopes: [<span class="type">ASAuthorization</span>.<span class="type">Scope</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完整的身份验证响应信息</span></span><br><span class="line">    <span class="keyword">@NSCopying</span> <span class="keyword">open</span> <span class="keyword">var</span> authenticatedResponse: <span class="type">HTTPURLResponse</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="授权成功"><a href="#授权成功" class="headerlink" title="授权成功"></a>授权成功</h3><p>上面有提到, 在<code>ASAuthorizationControllerDelegate</code>有两个协议方法, 分别是授权成功和失败的回调, 下面就具体看看</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">SignViewController</span>: <span class="title class_">ASAuthorizationControllerDelegate</span> &#123;</span><br><span class="line">    <span class="comment">// 处理成功的授权</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">authorizationController</span>(<span class="params">controller</span>: <span class="type">ASAuthorizationController</span>, <span class="params">didCompleteWithAuthorization</span> <span class="params">authorization</span>: <span class="type">ASAuthorization</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;授权成功&quot;</span>)</span><br><span class="line">        <span class="comment">// 成功的Apple ID身份验证信息</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> appleIDCreden <span class="operator">=</span> authorization.credential <span class="keyword">as?</span> <span class="type">ASAuthorizationAppleIDCredential</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> userIdentifier <span class="operator">=</span> appleIDCreden.user</span><br><span class="line">            <span class="keyword">let</span> fullName <span class="operator">=</span> appleIDCreden.fullName</span><br><span class="line">            <span class="keyword">let</span> email <span class="operator">=</span> appleIDCreden.email</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 这里需要我们在系统中创建一个账户, 用于存储用户的唯一标识userIdentifier</span></span><br><span class="line">            <span class="comment">// 可以在系统的钥匙串中存储</span></span><br><span class="line">            <span class="keyword">let</span> webVC <span class="operator">=</span> <span class="type">WebViewController</span>()</span><br><span class="line">            webVC.user <span class="operator">=</span> userIdentifier</span><br><span class="line">            webVC.giveName <span class="operator">=</span> fullName<span class="operator">?</span>.givenName <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            webVC.familyName <span class="operator">=</span> fullName<span class="operator">?</span>.familyName <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            webVC.email <span class="operator">=</span> email <span class="operator">??</span> <span class="string">&quot;&quot;</span></span><br><span class="line">            navigationController<span class="operator">?</span>.pushViewController(webVC, animated: <span class="literal">true</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">let</span> passwordCreden <span class="operator">=</span> authorization.credential <span class="keyword">as?</span> <span class="type">ASPasswordCredential</span> &#123;</span><br><span class="line">            <span class="comment">// 密码凭证用户的唯一标识</span></span><br><span class="line">            <span class="keyword">let</span> userIdentifiler <span class="operator">=</span> passwordCreden.user</span><br><span class="line">            <span class="comment">// 密码凭证的密码</span></span><br><span class="line">            <span class="keyword">let</span> password <span class="operator">=</span> passwordCreden.password</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示相关信息</span></span><br><span class="line">            <span class="keyword">let</span> message <span class="operator">=</span> <span class="string">&quot;APP已经收到您选择的秘钥凭证<span class="subst">\n</span>Username: <span class="subst">\(userIdentifiler)</span><span class="subst">\n</span> Password: <span class="subst">\(password)</span>&quot;</span></span><br><span class="line">            showLabel.text <span class="operator">=</span> message</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            showLabel.text <span class="operator">=</span> <span class="string">&quot;授权信息均不符&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 处理授权错误</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">authorizationController</span>(<span class="params">controller</span>: <span class="type">ASAuthorizationController</span>, <span class="params">didCompleteWithError</span> <span class="params">error</span>: <span class="type">Error</span>) &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;授权错误: <span class="subst">\(error)</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> showText <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> authError <span class="operator">=</span> error <span class="keyword">as?</span> <span class="type">ASAuthorizationError</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> code <span class="operator">=</span> authError.code</span><br><span class="line">            <span class="keyword">switch</span> code &#123;</span><br><span class="line">            <span class="keyword">case</span> .canceled:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;用户取消了授权请求&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .failed:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;授权请求失败&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .invalidResponse:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;授权请求响应无效&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .notHandled:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;未能处理授权请求&quot;</span></span><br><span class="line">            <span class="keyword">case</span> .unknown:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;授权请求失败, 未知的错误原因&quot;</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                showText <span class="operator">=</span> <span class="string">&quot;其他未知的错误原因&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        showLabel.text <span class="operator">=</span> showText</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<div class="note success"><p>做好了上面配置, 就可以看到下面的登录页面</p></div>



<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_sign.jpeg?x-oss-process=image/resize,m_lfit,h_500" alt="image"></p>
<ul>
<li>如果不修改姓名, 授权成功后将获取到用户的姓名</li>
<li>如果选择共享我的电子邮件, 授权成功将获取到用户的电子邮件地址</li>
<li>如果选择隐藏邮件地址, 授权成功将获取到一个虚拟的电子邮件地址</li>
<li>点击姓名右侧的清除按钮可以修改用户名, 如下页面</li>
</ul>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_name.jpeg?x-oss-process=image/resize,m_lfit,h_500" alt="name"></p>
<ul>
<li>如果登录用户修改了用户名, 那么授权成功后获取到的用户名就是修改后的</li>
<li>使用过<code>AppleID</code>登录过<code>App</code>，进入应用的时候会提示使用<code>TouchID</code>登录的场景如下</li>
</ul>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_has.jpeg?x-oss-process=image/resize,m_lfit,h_500" alt="image"></p>
<ul>
<li>如果使用指纹登录三次失败后, 下面会有一个使用密码继续的按钮, 可以使用手机密码继续登录</li>
<li>如果手机没有设置<code>Apple ID</code>, 使用苹果登录, 将会有弹窗提示,</li>
</ul>
<p><img data-src="https://titanjun.oss-cn-hangzhou.aliyuncs.com/ios/sign_noid.png" alt="image"></p>
<h2 id="监听授权状态"><a href="#监听授权状态" class="headerlink" title="监听授权状态"></a>监听授权状态</h2><p>在特殊情况下我们还需要监听授权状态的改变, 并进行相应的处理</p>
<ul>
<li>用户终止在该<code>App</code>中使用<code>Sign in with Apple</code>功能</li>
<li>用户在设置里注销了<code>Apple ID</code></li>
<li>针对类似这种情况, <code>App</code>需要获取到这些状态，然后做退出登录操作</li>
<li>我们需要在<code>App</code>启动的时候，来获取当前用户的授权状态</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ASAuthorizationAppleIDProvider提供了一个获取用户授权状态和授权凭据是否有效</span></span><br><span class="line"><span class="keyword">func</span> <span class="title function_">getCredentialState</span>(<span class="params">forUserID</span>: <span class="type">String</span>, <span class="params">completion</span>: (<span class="type">ASAuthorizationAppleIDProvider</span>.<span class="type">CredentialState</span>, <span class="type">Error</span>?) -&gt; <span class="type">Void</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ASAuthorizationAppleIDProvider.CredentialState的所有枚举值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CredentialState</span> : <span class="title class_">Int</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> revoked</span><br><span class="line">    <span class="keyword">case</span> authorized</span><br><span class="line">    <span class="keyword">case</span> notFound</span><br><span class="line">    <span class="keyword">case</span> transferred</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<div class="note success"><p>示例代码如下</p></div>



<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">application</span>(<span class="keyword">_</span> <span class="params">application</span>: <span class="type">UIApplication</span>, <span class="params">didFinishLaunchingWithOptions</span> <span class="params">launchOptions</span>: [<span class="type">UIApplication</span>.<span class="params">LaunchOptionsKey</span>: <span class="keyword">Any</span>]<span class="operator">?</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">        <span class="comment">// 钥匙串中取出的</span></span><br><span class="line">        <span class="keyword">let</span> userIdentifier <span class="operator">=</span> <span class="string">&quot;userIdentifier&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="operator">!</span>userIdentifier.isEmpty) &#123;</span><br><span class="line">            <span class="comment">// 基于用户的Apple ID授权用户，生成用户授权请求的一种机制</span></span><br><span class="line">            <span class="keyword">let</span> appleIDProvider <span class="operator">=</span> <span class="type">ASAuthorizationAppleIDProvider</span>()</span><br><span class="line">            <span class="comment">// 返回完成处理程序中给定用户的凭据状态</span></span><br><span class="line">            appleIDProvider.getCredentialState(forUserID: userIdentifier) &#123; (state, error) <span class="keyword">in</span></span><br><span class="line">                <span class="keyword">switch</span> state &#123;</span><br><span class="line">                <span class="keyword">case</span> .authorized:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;授权状态有效&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> .notFound:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;授权凭证缺失（可能是使用AppleID 登录过App）&quot;</span>)</span><br><span class="line">                <span class="keyword">case</span> .revoked:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;上次使用苹果账号登录的凭据已被移除，需解除绑定并重新引导用户使用苹果登录&quot;</span>)</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;未知状态&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除此之外还可以通过通知方法来监听<code>revoked</code>状态, 在<code>ASAuthorizationAppleIDProvider</code>中增加了一个属性, 用于监听<code>revoked</code>状态</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">let</span> <span class="title class_">credentialRevokedNotification</span>: <span class="title class_">NSNotification</span>.<span class="title class_">Name</span></span><br><span class="line"></span><br><span class="line">// 使用方法</span><br><span class="line"><span class="title class_">fileprivate</span> <span class="title class_">func</span> <span class="title class_">observeAppleSignInState</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">#available</span>(<span class="keyword">iOS</span> <span class="number">13.0</span>, <span class="operator">*</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> center <span class="operator">=</span> <span class="type">NotificationCenter</span>.default</span><br><span class="line">        center.addObserver(<span class="keyword">self</span>, selector: <span class="keyword">#selector</span>(handleStateChange(noti:)), name: <span class="type">ASAuthorizationAppleIDProvider</span>.credentialRevokedNotification, object: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@objc</span> <span class="keyword">fileprivate</span> <span class="keyword">func</span> <span class="title function_">handleStateChange</span>(<span class="params">noti</span>: <span class="keyword">Any</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;授权状态发生改变&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><code>Sign In with Apple</code>涉及到的相关资料文档如下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/authenticationservices">Sign In with Apple Entitlement</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/signinwithapplerestapi/generate_and_validate_tokens">Generate and validate tokens</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/authenticationservices/adding_the_sign_in_with_apple_flow_to_your_app">Adding the Sign In with Apple Flow to Your App</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-assets.developer.apple.com/published/8f9ca51349/AddingTheSignInWithAppleFlowToYourApp.zip">Sign In With Apple官方Demo(Swift版)</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wpf199402076118/article/details/99677412">Sign In with Apple后台配置</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
<div>
  <div style="text-align:center;color: #ccc;font-size:18px;">---------------  本文结束啦 <i class="fa fa-paw"></i> 感谢您的阅读  ---------------</div>	
</div>

          <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/pay-wechat.jpg" alt="TitanKing 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/pay-ali.jpg" alt="TitanKing 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>TitanKing
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://titanjun.top/post/de12f33.html" title="Sign In with Apple">https://titanjun.top/post/de12f33.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="followme">
  <span>欢迎关注我的其它发布渠道</span>

  <div class="social-list">

      <div class="social-item">
        <a target="_blank" class="social-link" href="/images/wechat-qcode.jpg">
          <span class="icon">
            <i class="fab fa-weixin"></i>
          </span>

          <span class="label">WeChat</span>
        </a>
      </div>

      <div class="social-item">
        <a target="_blank" class="social-link" href="/atom.xml">
          <span class="icon">
            <i class="fa fa-rss"></i>
          </span>

          <span class="label">RSS</span>
        </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/ios/" rel="tag"> <i class="fa fa-tag"></i> iOS</a>
          </div>

        
  <div class="post-widgets">
    <div class="wpac-rating-container">
      <div id="wpac-rating"></div>
    </div>
  </div>

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/bde391d5.html" rel="prev" title="浅谈Swift的属性(Property)">
                  <i class="fa fa-chevron-left"></i> 浅谈Swift的属性(Property)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/da0e549f.html" rel="next" title="iOS13适配深色模式(Dark Mode)">
                  iOS13适配深色模式(Dark Mode) <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2017 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TitanKing</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">885k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">13:24</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        本站访客数: <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        本站总访问量: <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>



<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("07/01/2016 09:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "+hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval("createtime()",250);
</script>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
  <script src="https://embed.widgetpack.com/widget.js" async></script>
  <script class="next-config" data-name="rating" type="application/json">{"enable":true,"id":10998,"color":null}</script>
  <script src="/js/third-party/rating.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>


  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://titanjun.top/post/de12f33.html"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>



  <!-- 页面点击效果 -->
  


  <script async src="/js/cursor/fireworks.js"></script>


</body>
</html>
